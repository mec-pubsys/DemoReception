# „Çø„Çπ„ÇØ7: CI/CD „Éë„Ç§„Éó„É©„Ç§„É≥ÊßãÁØâ

## Ê¶ÇË¶Å
GitHub Actions „Çí‰ΩøÁî®„Åó„Å¶„Ç≥„Éº„ÉâÂìÅË≥™‰øùË®º„ÉªËá™Âãï„ÉÜ„Çπ„Éà„Éª„Éá„Éó„É≠„Ç§„ÇíËá™ÂãïÂåñ„Åô„ÇãÈñãÁô∫„Éë„Ç§„Éó„É©„Ç§„É≥„ÇíÊßãÁØâ„Åô„Çã„ÄÇ

## CI/CD „Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£

### „Éë„Ç§„Éó„É©„Ç§„É≥ÊßãÊàê
```
üìù Code Push/PR ‚Üí üîç Quality Gate ‚Üí üß™ Testing ‚Üí üöÄ Deployment
                   ‚îÇ                ‚îÇ              ‚îÇ
                   ‚îú‚îÄ ESLint       ‚îú‚îÄ Unit Tests   ‚îú‚îÄ Staging
                   ‚îú‚îÄ TypeScript   ‚îú‚îÄ E2E Tests    ‚îî‚îÄ Production
                   ‚îú‚îÄ Security     ‚îî‚îÄ Accessibility
                   ‚îî‚îÄ Dependencies
```

## GitHub Actions „ÉØ„Éº„ÇØ„Éï„É≠„Éº

### 1. „Ç≥„Éº„ÉâÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØ

#### `.github/workflows/code-quality.yml`
```yaml
name: Code Quality Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  lint-and-type-check:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: example/package-lock.json
        
    - name: Install dependencies
      run: npm ci
      working-directory: ./example
      
    - name: Run ESLint
      run: |
        npm run lint || {
          echo "‚ùå ESLint failed. Please fix the linting errors."
          exit 1
        }
      working-directory: ./example
      
    - name: Run TypeScript check
      run: |
        npx tsc --noEmit || {
          echo "‚ùå TypeScript compilation failed. Please fix type errors."
          exit 1
        }
      working-directory: ./example
      
    - name: Run Prettier check
      run: |
        npx prettier --check "src/**/*.{ts,tsx,js,jsx}" || {
          echo "‚ùå Code formatting check failed. Run 'npm run format' to fix."
          exit 1
        }
      working-directory: ./example
      
    - name: Check for TODO/FIXME comments
      run: |
        if grep -r "TODO\|FIXME" example/src/; then
          echo "‚ö†Ô∏è  Found TODO/FIXME comments. Please address them before merging."
          exit 1
        fi
        
  security-audit:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: example/package-lock.json
        
    - name: Install dependencies
      run: npm ci
      working-directory: ./example
      
    - name: Run npm audit
      run: |
        npm audit --audit-level high || {
          echo "‚ùå High security vulnerabilities found. Please fix them."
          exit 1
        }
      working-directory: ./example
      
    - name: Check for hardcoded secrets
      uses: trufflesecurity/trufflehog@main
      with:
        path: ./
        base: main
        head: HEAD
        
    - name: License compliance check
      run: |
        npx license-checker \
          --onlyAllow 'MIT;Apache-2.0;BSD-2-Clause;BSD-3-Clause;ISC;0BSD' \
          --excludePrivatePackages || {
            echo "‚ùå License compliance check failed."
            exit 1
          }
      working-directory: ./example
```

### 2. „ÉÜ„Çπ„ÉàÂÆüË°å

#### `.github/workflows/tests.yml`
```yaml
name: Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  unit-tests:
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        node-version: [18, 20]
        
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v4
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
        cache-dependency-path: example/package-lock.json
        
    - name: Install dependencies
      run: npm ci
      working-directory: ./example
      
    - name: Run unit tests
      run: |
        npm run test -- --coverage --watchAll=false || {
          echo "‚ùå Unit tests failed."
          exit 1
        }
      working-directory: ./example
      env:
        CI: true
        
    - name: Upload coverage to Codecov
      uses: codecov/codecov-action@v3
      with:
        file: ./example/coverage/lcov.info
        flags: unittests
        name: codecov-umbrella
        
    - name: Coverage threshold check
      run: |
        COVERAGE=$(npm run test:coverage:check 2>/dev/null || echo "0")
        if [ "$COVERAGE" -lt 70 ]; then
          echo "‚ùå Coverage is below 70%: $COVERAGE%"
          exit 1
        fi
        echo "‚úÖ Coverage: $COVERAGE%"
      working-directory: ./example

  integration-tests:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: example/package-lock.json
        
    - name: Install dependencies
      run: npm ci
      working-directory: ./example
      
    - name: Start test servers
      run: |
        # Firebase Emulator
        npm install -g firebase-tools
        firebase emulators:start --only auth,database --detach
        
        # Metro bundler for testing
        npm start &
        sleep 30
      working-directory: ./example
      
    - name: Run integration tests
      run: |
        npm run test:integration || {
          echo "‚ùå Integration tests failed."
          exit 1
        }
      working-directory: ./example
      env:
        FIREBASE_AUTH_EMULATOR_HOST: localhost:9099
        FIREBASE_DATABASE_EMULATOR_HOST: localhost:9000

  e2e-tests:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: example/package-lock.json
        
    - name: Install dependencies
      run: npm ci
      working-directory: ./example
      
    - name: Setup Expo CLI
      run: npm install -g @expo/cli
      
    - name: Start Expo
      run: |
        expo start --web --non-interactive &
        sleep 60
      working-directory: ./example
      
    - name: Install Playwright
      run: npx playwright install --with-deps
      
    - name: Run E2E tests
      run: |
        npm run test:e2e || {
          echo "‚ùå E2E tests failed."
          exit 1
        }
      working-directory: ./example
      
    - name: Upload test artifacts
      uses: actions/upload-artifact@v3
      if: failure()
      with:
        name: e2e-test-results
        path: example/test-results/
```

### 3. „Éá„Éó„É≠„Ç§„É°„É≥„Éà

#### `.github/workflows/deploy.yml`
```yaml
name: Deploy

on:
  push:
    branches: [ main ]
  release:
    types: [ published ]

jobs:
  deploy-staging:
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    environment: staging
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: example/package-lock.json
        
    - name: Install dependencies
      run: npm ci
      working-directory: ./example
      
    - name: Setup Expo CLI
      run: npm install -g @expo/cli eas-cli
      
    - name: Authenticate with Expo
      run: expo login --non-interactive
      env:
        EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        
    - name: Build for staging
      run: |
        eas build --platform all --profile staging --non-interactive || {
          echo "‚ùå Staging build failed."
          exit 1
        }
      working-directory: ./example
      env:
        EXPO_PUBLIC_ENV: staging
        EXPO_PUBLIC_FIREBASE_AUTH_EMAIL: ${{ secrets.STAGING_FIREBASE_AUTH_EMAIL }}
        EXPO_PUBLIC_FIREBASE_AUTH_PASSWORD: ${{ secrets.STAGING_FIREBASE_AUTH_PASSWORD }}
        
    - name: Deploy to Expo
      run: |
        expo publish --release-channel staging || {
          echo "‚ùå Staging deployment failed."
          exit 1
        }
      working-directory: ./example
      
    - name: Notify deployment
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        text: "üöÄ Staging deployment completed: https://exp.host/@youruser/demoreception?release-channel=staging"
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

  deploy-production:
    if: github.event_name == 'release'
    runs-on: ubuntu-latest
    environment: production
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: example/package-lock.json
        
    - name: Install dependencies
      run: npm ci
      working-directory: ./example
      
    - name: Setup Expo CLI
      run: npm install -g @expo/cli eas-cli
      
    - name: Authenticate with Expo
      run: expo login --non-interactive
      env:
        EXPO_TOKEN: ${{ secrets.EXPO_TOKEN }}
        
    - name: Build for production
      run: |
        eas build --platform all --profile production --non-interactive || {
          echo "‚ùå Production build failed."
          exit 1
        }
      working-directory: ./example
      env:
        EXPO_PUBLIC_ENV: production
        EXPO_PUBLIC_FIREBASE_AUTH_EMAIL: ${{ secrets.PROD_FIREBASE_AUTH_EMAIL }}
        EXPO_PUBLIC_FIREBASE_AUTH_PASSWORD: ${{ secrets.PROD_FIREBASE_AUTH_PASSWORD }}
        
    - name: Submit to app stores
      run: |
        eas submit --platform all --latest || {
          echo "‚ùå App store submission failed."
          exit 1
        }
      working-directory: ./example
      
    - name: Deploy to Expo
      run: |
        expo publish --release-channel production || {
          echo "‚ùå Production deployment failed."
          exit 1
        }
      working-directory: ./example
      
    - name: Create GitHub Pages deployment
      run: |
        npm run build:web
        echo "demoreception.example.com" > build/CNAME
      working-directory: ./example
      
    - name: Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./example/build
        
    - name: Notify deployment
      uses: 8398a7/action-slack@v3
      with:
        status: ${{ job.status }}
        text: "üéâ Production deployment completed! App stores submission in progress."
      env:
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
```

### 4. „Éñ„É©„É≥„ÉÅ‰øùË≠∑„ÉªÂìÅË≥™„Ç≤„Éº„Éà

#### `.github/workflows/branch-protection.yml`
```yaml
name: Branch Protection

on:
  pull_request:
    branches: [ main ]

jobs:
  quality-gate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        cache-dependency-path: example/package-lock.json
        
    - name: Install dependencies
      run: npm ci
      working-directory: ./example
      
    - name: Check commit message format
      run: |
        git log --oneline -1 --pretty=format:"%s" | grep -E "^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .{1,50}" || {
          echo "‚ùå Commit message does not follow Conventional Commits format"
          echo "Format: type(scope): description"
          echo "Example: feat(login): add password visibility toggle"
          exit 1
        }
        
    - name: Check for breaking changes
      run: |
        git diff --name-only origin/main..HEAD | grep -E "(package\.json|app\.json|expo\.json)" && {
          echo "‚ö†Ô∏è  Configuration files changed. Manual review required."
        } || true
        
    - name: Require all checks to pass
      run: |
        echo "‚úÖ All quality gates passed"
```

## ÈñãÁô∫„ÉÑ„Éº„É´Ë®≠ÂÆö

### 1. package.json „Çπ„ÇØ„É™„Éó„ÉàËøΩÂä†
```json
{
  "scripts": {
    "lint": "eslint src/ --ext .ts,.tsx,.js,.jsx",
    "lint:fix": "eslint src/ --ext .ts,.tsx,.js,.jsx --fix",
    "format": "prettier --write \"src/**/*.{ts,tsx,js,jsx,json,md}\"",
    "format:check": "prettier --check \"src/**/*.{ts,tsx,js,jsx,json,md}\"",
    "type-check": "tsc --noEmit",
    "test": "jest",
    "test:coverage": "jest --coverage",
    "test:coverage:check": "jest --coverage --silent | grep 'All files' | awk '{print $10}' | sed 's/%//'",
    "test:watch": "jest --watch",
    "test:integration": "jest --config jest.integration.config.js",
    "test:e2e": "playwright test",
    "build:web": "expo build:web",
    "build:android": "eas build --platform android",
    "build:ios": "eas build --platform ios",
    "deploy:staging": "expo publish --release-channel staging",
    "deploy:production": "expo publish --release-channel production"
  }
}
```

### 2. ESLint Ë®≠ÂÆö
```javascript
// .eslintrc.js
module.exports = {
  extends: [
    'expo',
    '@react-native-community',
    'plugin:@typescript-eslint/recommended',
    'plugin:react-hooks/recommended',
    'prettier'
  ],
  plugins: [
    '@typescript-eslint',
    'react-hooks',
    'import',
    'jsx-a11y'
  ],
  rules: {
    // TypeScript
    '@typescript-eslint/no-unused-vars': 'error',
    '@typescript-eslint/no-explicit-any': 'warn',
    '@typescript-eslint/explicit-function-return-type': 'off',
    
    // React
    'react/prop-types': 'off',
    'react-hooks/rules-of-hooks': 'error',
    'react-hooks/exhaustive-deps': 'warn',
    
    // Import
    'import/order': ['error', {
      'groups': ['builtin', 'external', 'internal', 'parent', 'sibling', 'index'],
      'newlines-between': 'always'
    }],
    
    // Accessibility
    'jsx-a11y/accessible-emoji': 'warn',
    'jsx-a11y/alt-text': 'warn',
    
    // General
    'no-console': 'warn',
    'no-debugger': 'error',
    'prefer-const': 'error'
  },
  ignorePatterns: [
    'node_modules/',
    'build/',
    'dist/',
    'coverage/'
  ]
};
```

### 3. Prettier Ë®≠ÂÆö
```json
// .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": true,
  "printWidth": 80,
  "tabWidth": 2,
  "useTabs": false,
  "bracketSpacing": true,
  "arrowParens": "avoid",
  "endOfLine": "lf"
}
```

### 4. GitHub repository settings
```yaml
# .github/branch-protection.yml (Ë®≠ÂÆöÂèÇËÄÉ)
branch_protection_rules:
  - pattern: "main"
    required_status_checks:
      strict: true
      contexts:
        - "Code Quality Check / lint-and-type-check"
        - "Code Quality Check / security-audit"
        - "Tests / unit-tests (18)"
        - "Tests / integration-tests"
        - "Branch Protection / quality-gate"
    enforce_admins: true
    required_pull_request_reviews:
      required_approving_review_count: 1
      dismiss_stale_reviews: true
      require_code_owner_reviews: true
    restrictions: null
```

## Áí∞Â¢ÉÁÆ°ÁêÜ

### 1. Áí∞Â¢ÉÂà•Ë®≠ÂÆö
```typescript
// app.config.ts
export default ({ config }: any) => {
  const environment = process.env.EXPO_PUBLIC_ENV || 'development';
  
  const baseConfig = {
    ...config,
    name: environment === 'production' ? 'DemoReception' : `DemoReception (${environment})`,
    slug: 'demoreception',
    version: '1.0.0',
    platforms: ['ios', 'android', 'web'],
  };

  if (environment === 'staging') {
    return {
      ...baseConfig,
      extra: {
        environment: 'staging',
        apiUrl: 'https://staging-api.example.com',
      },
    };
  }

  if (environment === 'production') {
    return {
      ...baseConfig,
      extra: {
        environment: 'production',
        apiUrl: 'https://api.example.com',
      },
    };
  }

  return {
    ...baseConfig,
    extra: {
      environment: 'development',
      apiUrl: 'http://localhost:3000',
    },
  };
};
```

### 2. EAS Ë®≠ÂÆö
```json
// eas.json
{
  "cli": {
    "version": ">= 3.0.0"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal",
      "env": {
        "EXPO_PUBLIC_ENV": "development"
      }
    },
    "staging": {
      "distribution": "internal",
      "env": {
        "EXPO_PUBLIC_ENV": "staging"
      }
    },
    "production": {
      "env": {
        "EXPO_PUBLIC_ENV": "production"
      }
    }
  },
  "submit": {
    "production": {
      "ios": {
        "appleId": "your-apple-id@example.com",
        "ascAppId": "1234567890",
        "appleTeamId": "ABCD123456"
      },
      "android": {
        "serviceAccountKeyPath": "./service-account-key.json",
        "track": "production"
      }
    }
  }
}
```

## ÂÆüË£Ö„Çπ„Ç±„Ç∏„É•„Éº„É´

### Phase 1: Âü∫Êú¨„Éë„Ç§„Éó„É©„Ç§„É≥ (2Êó•)
- GitHub Actions „ÉØ„Éº„ÇØ„Éï„É≠„Éº‰ΩúÊàê
- ESLint, Prettier, TypeScript „ÉÅ„Çß„ÉÉ„ÇØ

### Phase 2: „ÉÜ„Çπ„ÉàËá™ÂãïÂåñ (2Êó•)
- Unit test, Integration test ÂÆüË°å
- „Ç´„Éê„É¨„ÉÉ„Ç∏Ë®àÊ∏¨„Éª„É¨„Éù„Éº„Éà

### Phase 3: „Éá„Éó„É≠„Ç§„É°„É≥„Éà (1Êó•)
- Staging/Production „Éá„Éó„É≠„Ç§
- „Ç¢„Éó„É™„Çπ„Éà„Ç¢Áî≥Ë´ãËá™ÂãïÂåñ

## ÊàêÂäüÊåáÊ®ô
- [ ] ÂÖ® PR „ÅßÂìÅË≥™„ÉÅ„Çß„ÉÉ„ÇØÂÆüË°å
- [ ] „ÉÜ„Çπ„Éà„Ç´„Éê„É¨„ÉÉ„Ç∏ 70% ‰ª•‰∏ä
- [ ] „Éá„Éó„É≠„Ç§ÊôÇÈñì 10ÂàÜ‰ª•ÂÜÖ
- [ ] „Çº„É≠„ÉÄ„Ç¶„É≥„Çø„Ç§„É†„Éá„Éó„É≠„Ç§
- [ ] Ëá™Âãï„Çª„Ç≠„É•„É™„ÉÜ„Ç£Áõ£Êüª

## ÊâÄË¶ÅÊôÇÈñì
Á¥Ñ5Êó•

## ÂøÖË¶Å„Å™„Ç∑„Éº„ÇØ„É¨„ÉÉ„Éà
- `EXPO_TOKEN`
- `STAGING_FIREBASE_AUTH_EMAIL/PASSWORD`
- `PROD_FIREBASE_AUTH_EMAIL/PASSWORD`
- `SLACK_WEBHOOK_URL`
- `GITHUB_TOKEN` (Ëá™ÂãïË®≠ÂÆö)